<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rekap SA, Jadwal, dan Pengiriman</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #f0f7ff;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    min-width: 900px;
  }
  th, td {
    border: 1px solid #e2e8f0;
    padding: 6px 8px;
    text-align: center;
    font-size: 14px;
    white-space: nowrap;
  }
  th {
    background-color: #3b82f6;
    color: white;
    position: sticky;
    top: 0;
    z-index: 2;
  }
  td:first-child, th:first-child,
  td:nth-child(2), th:nth-child(2) {
    position: sticky;
    left: 0;
    z-index: 1;
    background: #f8fafc;
  }
  td:nth-child(2), th:nth-child(2) {
    left: 120px;
  }
  .scroll-wrapper {
    overflow: auto;
    max-height: 75vh;
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    background: white;
  }
  .filter-bar {
    background: white;
    position: sticky;
    top: 0;
    z-index: 10;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  }
</style>
</head>
<body class="p-4">

<!-- 🔍 FILTER AREA -->
<div class="filter-bar rounded-xl p-3 mb-4 flex flex-wrap gap-2 items-center justify-between">
  <div class="flex flex-wrap gap-2 items-center">
    <button id="btnPilihPangkalan" class="bg-blue-500 text-white px-3 py-1 rounded-lg shadow hover:bg-blue-600 transition">
      Pilih Pangkalan
    </button>
    <button id="btnPilihPT" class="bg-blue-500 text-white px-3 py-1 rounded-lg shadow hover:bg-blue-600 transition">
      Pilih PT
    </button>
  </div>
  <input id="searchInput" type="text" placeholder="Cari pangkalan / PT..." 
    class="border rounded-lg px-3 py-1 focus:ring-2 focus:ring-blue-400 outline-none w-60">
</div>

<!-- 🧊 TABEL DATA -->
<div class="scroll-wrapper" id="tabel-container">
  <p class="text-center text-gray-500 py-8">Memuat data...</p>
</div>

<script>
/* === DUMMY UNTUK CONTOH === */
const info = {
  tanggalSet: ["01/10/2025","02/10/2025","03/10/2025"],
  result: [
    { namaPangkalan: "Pangkalan A", namaPT: "PT Maju", data: {
      "01/10/2025": { SA: 50, JH: 48, IS: 47 },
      "02/10/2025": { SA: 50, JH: 50, IS: 50 },
      "03/10/2025": { SA: 40, JH: 38, IS: 35 },
    }},
    { namaPangkalan: "Pangkalan B", namaPT: "PT Jaya", data: {
      "01/10/2025": { SA: 60, JH: 60, IS: 59 },
      "02/10/2025": { SA: 60, JH: 58, IS: 58 },
      "03/10/2025": { SA: 55, JH: 55, IS: 54 },
    }}
  ],
  spbe: [
    { namaSPBE: "SPBE ABC", namaPT: "PT Maju", data: { "01/10/2025": 100, "02/10/2025": 100, "03/10/2025": 80 }},
    { namaSPBE: "SPBE XYZ", namaPT: "PT Jaya", data: { "01/10/2025": 120, "02/10/2025": 100, "03/10/2025": 110 }}
  ]
};

function renderTable(info){
  const container=document.getElementById('tabel-container');
  const tanggalSet=info.tanggalSet||[];
  const data=info.result||[];
  const spbeData=info.spbe||[];

  if(tanggalSet.length===0){ container.innerHTML=`<p class='text-gray-500 text-center'>Tidak ada data.</p>`; return; }

  let html=`<table><thead><tr>
    <th rowspan="2">Nama Pangkalan</th>
    <th rowspan="2">Nama PT</th>`;
  tanggalSet.forEach(tgl=>html+=`<th colspan="3">${tgl}</th>`);
  html+=`<th rowspan="2">Selisih Jadwal<br>(SA-JH)</th>
         <th rowspan="2">Selisih Pengiriman<br>(JH-P)</th>`;
  html+=`</tr><tr>`;
  tanggalSet.forEach(()=>html+=`
    <th>SA 📅</th><th>JH 📃</th><th>P 🚚</th>`);
  html+=`</tr></thead><tbody>`;

  const totalPerTanggal={}; tanggalSet.forEach(tgl=>totalPerTanggal[tgl]={SA:0,JH:0,IS:0});

  data.forEach(row=>{
    html+=`<tr><td>${row.namaPangkalan}</td><td>${row.namaPT}</td>`;
    let totalSA=0,totalJH=0,totalIS=0;
    tanggalSet.forEach(tgl=>{
      const isi=row.data[tgl]||{};
      const SA=Number(isi.SA||0),JH=Number(isi.JH||0),IS=Number(isi.IS||0);
      html+=`<td>${SA}</td><td>${JH}</td><td>${IS||'-'}</td>`;
      totalSA+=SA; totalJH+=JH; totalIS+=IS;
      totalPerTanggal[tgl].SA+=SA;
      totalPerTanggal[tgl].JH+=JH;
      totalPerTanggal[tgl].IS+=IS;
    });
    const selJadwal = totalSA - totalJH;
    const selKirim = totalJH - totalIS;
    html+=`<td class="${selJadwal!==0?'text-red-600 font-bold':''}">${selJadwal}</td>
           <td class="${selKirim!==0?'text-red-600 font-bold':''}">${selKirim}</td></tr>`;
  });

  // === TOTAL PANGKALAN ===
  html+=`<tr class="font-semibold bg-blue-100"><td colspan="2">TOTAL</td>`;
  tanggalSet.forEach(tgl=>{
    const t=totalPerTanggal[tgl];
    html+=`<td>${t.SA}</td><td>${t.JH}</td><td>${t.IS}</td>`;
  });
  const totalSelJadwal = Object.values(totalPerTanggal).reduce((a,b)=>a+(b.SA-b.JH),0);
  const totalSelKirim = Object.values(totalPerTanggal).reduce((a,b)=>a+(b.JH-b.IS),0);
  html+=`<td>${totalSelJadwal}</td><td>${totalSelKirim}</td></tr>`;

  // === SPBE + STOK ===
  const totalSPBE={}; tanggalSet.forEach(tgl=>totalSPBE[tgl]=0);
  spbeData.forEach(sp=>{
    html+=`<tr class="bg-yellow-50 font-semibold">
      <td>${sp.namaSPBE}</td><td>${sp.namaPT||'-'}</td>`;
    tanggalSet.forEach(tgl=>{
      const val=Number(sp.data[tgl]||0);
      totalSPBE[tgl]+=val;
      html+=`<td colspan="3" class="text-center">${val}</td>`;
    });
    html+=`<td colspan="2"></td></tr>`;
  });

  html+=`<tr class="bg-yellow-200 font-bold"><td colspan="2">TOTAL SPBE</td>`;
  tanggalSet.forEach(tgl=>html+=`<td colspan="3">${totalSPBE[tgl]}</td>`);
  html+=`<td colspan="2"></td></tr>`;

  let sisaSebelumnya=0;
  html+=`<tr class="bg-green-100 font-bold"><td colspan="2">SISA / STOK GUDANG</td>`;
  tanggalSet.forEach((tgl,i)=>{
    const totalP = totalPerTanggal[tgl].IS||0;
    const stokMasuk = totalSPBE[tgl]||0;
    const sisaSekarang = i===0 ? stokMasuk-totalP : (sisaSebelumnya+stokMasuk)-totalP;
    sisaSebelumnya = sisaSekarang;
    html+=`<td colspan="3">${sisaSekarang}</td>`;
  });
  html+=`<td colspan="2"></td></tr>`;

  html+=`</tbody></table>`;
  container.innerHTML=html;
}

renderTable(info);
</script>
</body>
</html>
